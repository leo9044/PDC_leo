# ë‹¤ì¤‘ ECU í†µì‹  í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨
1. [í˜„ì¬ í†µì‹  êµ¬ì¡° ë¶„ì„](#í˜„ì¬-í†µì‹ -êµ¬ì¡°-ë¶„ì„)
2. [í…ŒìŠ¤íŠ¸ 1: VehicleControl â†” AmbientApp](#í…ŒìŠ¤íŠ¸-1-vehiclecontrol--ambientapp)
3. [í…ŒìŠ¤íŠ¸ 2: VehicleControl â†” IC_app](#í…ŒìŠ¤íŠ¸-2-vehiclecontrol--ic_app)
4. [í…ŒìŠ¤íŠ¸ 3: GearApp â†” AmbientApp](#í…ŒìŠ¤íŠ¸-3-gearapp--ambientapp)
5. [í†µí•© í…ŒìŠ¤íŠ¸: ì „ì²´ ì‹œìŠ¤í…œ](#í†µí•©-í…ŒìŠ¤íŠ¸-ì „ì²´-ì‹œìŠ¤í…œ)
6. [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)

---

## í˜„ì¬ í†µì‹  êµ¬ì¡° ë¶„ì„

### ğŸ¯ ì„œë¹„ìŠ¤ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SOME/IP Network (ECU ê°„ í†µì‹ )                     â”‚
â”‚                   Multicast: 224.244.224.245:30490                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“                                         â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ECU1 (192.168.1.100)    â”‚              â”‚  ECU2 (192.168.1.101)           â”‚
â”‚  Vehicle Control ECU     â”‚              â”‚  Infotainment ECU               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          â”‚              â”‚                                 â”‚
â”‚ VehicleControlApp        â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  [Service Provider]      â”‚â—„â”€â”€â”€â”€â”€RPCâ”€â”€â”€â”€â”€â”¼â”€â”€â”‚ GearApp                 â”‚   â”‚
â”‚                          â”‚              â”‚  â”‚  [Client]               â”‚   â”‚
â”‚  Service: 0x1234:0x5678  â”‚              â”‚  â”‚  GUI: Gear Selection    â”‚   â”‚
â”‚  Port: 30501 (unreliable)â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  Port: 30502 (reliable)  â”‚              â”‚                                 â”‚
â”‚  [Host] Routing Manager  â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                          â”‚â”€â”€Eventâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â–ºâ”‚ AmbientApp              â”‚   â”‚
â”‚  Events:                 â”‚  gearChanged â”‚  â”‚  [Client]               â”‚   â”‚
â”‚  - gearChanged           â”‚              â”‚  â”‚  Ambient Light Control  â”‚   â”‚
â”‚  - vehicleStateChanged   â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚              â”‚            â–²                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚            â”‚ HU ë‚´ë¶€ í†µì‹       â”‚
                                          â”‚            â”‚ (vsomeip local)   â”‚
                                          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                                          â”‚  â”‚ MediaApp                â”‚   â”‚
                                          â”‚  â”‚  [Service: 0x1235]      â”‚   â”‚
                                          â”‚  â”‚  Volume Event Provider  â”‚   â”‚
                                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                          â”‚                                 â”‚
                                          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                                          â”‚  â”‚ IC_app                  â”‚   â”‚
                                          â”‚â—„â”€Eventâ”€ [Client]           â”‚   â”‚
                                          â”‚  vehicleStateChanged        â”‚   â”‚
                                          â”‚  â”‚  Dashboard Display      â”‚   â”‚
                                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                          â”‚                                 â”‚
                                          â”‚  [Host] Routing Manager         â”‚
                                          â”‚  (ëª¨ë“  HU/IC ì•± ê³µìœ )           â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Š ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ë³´

#### ECU1 - Vehicle Control ECU (192.168.1.100)

| App | Application ID | ì—­í•  | Service/Client | Port | Routing |
|-----|----------------|------|----------------|------|---------|
| VehicleControlApp | 0x1001 | ì°¨ëŸ‰ ì œì–´ ë¡œì§, ìƒíƒœ í¼ë¸”ë¦¬ì…” | Service 0x1234:0x5678 | 30501(UDP), 30502(TCP) | VehicleControlECU [Host] |

**ì œê³µ ì„œë¹„ìŠ¤:**
- `setGearPosition(gear)` - RPC method
- `gearChanged(newGear, oldGear, timestamp)` - Event â†’ GearApp, AmbientApp
- `vehicleStateChanged(gear, speed, battery, timestamp)` - Event â†’ IC_app

---

#### ECU2 - Infotainment ECU (192.168.1.101)

**HU ì‹œìŠ¤í…œ (Main Display)**

| App | Application ID | ì—­í•  | Service/Client | í†µì‹  ëŒ€ìƒ |
|-----|----------------|------|----------------|-----------|
| GearApp | 0x0100 | ê¸°ì–´ ì„ íƒ GUI | Client 0x1234:0x5678 | ECU1 (RPC + Event) |
| AmbientApp | 0x0200 | ì•°ë¹„ì–¸íŠ¸ ë¼ì´íŠ¸ ì œì–´ | Client 0x1234:0x5678<br>Client 0x1235:0x5679 | ECU1 (Event)<br>MediaApp (Event) |
| MediaApp | 0x1236 | ë¯¸ë””ì–´ ì¬ìƒ, ë³¼ë¥¨ ì œì–´ | Service 0x1235:0x5679 | AmbientApp (Event) |
| MainHUApp | 0x0150 | í†µí•© HU GUI | - | GearApp, AmbientApp, MediaApp í†µí•© |

**IC ì‹œìŠ¤í…œ (Instrument Cluster Display)**

| App | Application ID | ì—­í•  | Service/Client | í†µì‹  ëŒ€ìƒ |
|-----|----------------|------|----------------|-----------|
| IC_app | 0x0300 | ê³„ê¸°íŒ í‘œì‹œ | Client 0x1234:0x5678 | ECU1 (Event) |

**ECU2 Routing Manager:**
- ì´ë¦„: `"HU-IC-Routing"` (ECU2ì˜ ëª¨ë“  ì•±ì´ ê³µìœ )
- ëª¨ë“œ: [Host]
- ë‹´ë‹¹: GearApp, AmbientApp, MediaApp, IC_app ëª¨ë‘ ì´ ë¼ìš°íŒ… ë§¤ë‹ˆì € ì‚¬ìš©

### âš ï¸ ë°œê²¬ëœ ë¬¸ì œì 

#### 1. AmbientApp ì„¤ì • ë¬¸ì œ
```json
{
    "unicast": "127.0.0.1",  // â† ë¡œì»¬í˜¸ìŠ¤íŠ¸! ECU ê°„ í†µì‹  ë¶ˆê°€ (ECU2ì˜ IPë¡œ ë³€ê²½ í•„ìš”)
    "clients": [
        {
            "service": "0x1235",  // â† MediaApp ì„œë¹„ìŠ¤ (OK)
            "instance": "0x5679"   
        }
    ]
}
```

**ë¬¸ì œ:**
- âŒ `127.0.0.1` â†’ ECU1(192.168.1.100)ê³¼ í†µì‹  ë¶ˆê°€
- âŒ VehicleControl ì„œë¹„ìŠ¤(0x1234) Client ì„¤ì • ëˆ„ë½
- âŒ `routing` í•„ë“œ ëˆ„ë½ â†’ ECU2ì˜ ê³µìœ  ë¼ìš°íŒ… ë§¤ë‹ˆì € ì‚¬ìš© ë¶ˆê°€

**í•„ìš”í•œ ìˆ˜ì •:**
- `unicast`: `192.168.1.101` (ECU2 IP)
- `clients`ì— VehicleControl ì„œë¹„ìŠ¤(0x1234:0x5678) ì¶”ê°€
- MediaApp ì„œë¹„ìŠ¤(0x1235:0x5679)ëŠ” ìœ ì§€
- `routing` í•„ë“œ ì œê±° (ECU2 ê³µìœ  ë¼ìš°íŒ… ë§¤ë‹ˆì € ì‚¬ìš©)

---

#### 2. IC_app ì„¤ì • ë¬¸ì œ
```json
{
    "routing": "vsomeipd",  // â† ë…ë¦½ ë¼ìš°íŒ… ë§¤ë‹ˆì €? ECU2 ê³µìœ  ë§¤ë‹ˆì € ì‚¬ìš©í•´ì•¼ í•¨
    "services": [  // â† Clientì¸ë° "services" ì‚¬ìš©
        {
            "service": "0x1234",
            "instance": "0x5678",
            "unreliable": "30508"  // â† ClientëŠ” í¬íŠ¸ ì„¤ì • ë¶ˆí•„ìš”
        }
    ]
}
```

**ë¬¸ì œ:**
- âŒ `"routing": "vsomeipd"` â†’ ë…ë¦½ ë¼ìš°íŒ… ë§¤ë‹ˆì € ì‹œë„ (ECU2 ê³µìœ  ë§¤ë‹ˆì €ì™€ ì¶©ëŒ)
- âŒ Clientì¸ë° `"services"` ì‚¬ìš© (ì˜¬ë°”ë¥¸ ê²ƒì€ `"clients"`)
- âŒ Clientì— í¬íŠ¸ ì§€ì • (30508) - ë¶ˆí•„ìš”

**í•„ìš”í•œ ìˆ˜ì •:**
- `routing` í•„ë“œ ì œê±° (ECU2 ê³µìœ  ë¼ìš°íŒ… ë§¤ë‹ˆì € ìë™ ì‚¬ìš©)
- `"services"` â†’ `"clients"`ë¡œ ë³€ê²½
- `unreliable` í¬íŠ¸ ì œê±°

---

#### 3. ECU2 ê³µìœ  ë¼ìš°íŒ… ë§¤ë‹ˆì € ì „ëµ

ECU2ì—ì„œëŠ” **GearApp, AmbientApp, MediaApp, IC_app** ëª¨ë‘ê°€ í•˜ë‚˜ì˜ ë¼ìš°íŒ… ë§¤ë‹ˆì €ë¥¼ ê³µìœ í•´ì•¼ í•©ë‹ˆë‹¤.

**âœ… ë°©ë²• 2: ì „ìš© vsomeip ë°ëª¬ ì‹¤í–‰ (ê¶Œì¥ - í˜„ì¬ ì‚¬ìš© ì¤‘)**

ì „ìš© ë¼ìš°íŒ… ë§¤ë‹ˆì € ë°ëª¬ì„ ë…ë¦½ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰í•˜ê³ , ëª¨ë“  ì•±ì€ `routing` í•„ë“œ ì—†ì´ ìë™ìœ¼ë¡œ ì—°ê²°í•©ë‹ˆë‹¤.

```bash
# ECU2ì—ì„œ ë¼ìš°íŒ… ë§¤ë‹ˆì € ì‹¤í–‰
cd ~/DES_Head-Unit/app/config
./start_routing_manager_ecu2.sh

# ë˜ëŠ” ì „ì²´ ì‹œìŠ¤í…œ ìë™ ì‹¤í–‰ (ë¼ìš°íŒ… ë§¤ë‹ˆì € + ëª¨ë“  ì•±)
./start_all_ecu2.sh
```

**ë¼ìš°íŒ… ë§¤ë‹ˆì € ì„¤ì • (`routing_manager_ecu2.json`):**
```json
{
    "unicast": "192.168.1.101",
    "applications": [
        {
            "name": "routingmanagerd",
            "id": "0xFFFF"
        }
    ],
    "routing": "routingmanagerd",  // â† ì´ í”„ë¡œì„¸ìŠ¤ê°€ [Host]
    "service-discovery": { ... }
}
```

**ëª¨ë“  ì•± ì„¤ì • (GearApp, AmbientApp, IC_app, MediaApp):**
```json
{
    "applications": [
        { "name": "GearApp", "id": "0x0100" }
    ],
    // routing í•„ë“œ ì—†ìŒ â†’ ìë™ìœ¼ë¡œ ë¼ìš°íŒ… ë§¤ë‹ˆì € ì‚¬ìš©
    "service-discovery": { ... }
}
```

**ì¥ì :**
- âœ… ì•± ë…ë¦½ì„±: í•œ ì•± ì¬ì‹œì‘ ì‹œ ë‹¤ë¥¸ ì•± ì˜í–¥ ì—†ìŒ
- âœ… ì•ˆì •ì„±: ë¼ìš°íŒ… ë§¤ë‹ˆì €ê°€ í•­ìƒ ì‹¤í–‰ ì¤‘
- âœ… í™•ì¥ì„±: ìƒˆ ì•± ì¶”ê°€ ê°„í¸
- âœ… ëª…í™•ì„±: ì—­í•  ë¶„ë¦¬ê°€ ëª…í™•í•¨

**ë°©ë²• 1: GearAppì´ ë¼ìš°íŒ… ë§¤ë‹ˆì € ì—­í•  (ì´ì „ ë°©ì‹)**

```json
// GearApp/vsomeip.json
{
    "routing": "client-sample",  // â† ì´ ì•±ì´ [Host] ë¼ìš°íŒ… ë§¤ë‹ˆì €
    "applications": [
        { "name": "GearApp", "id": "0x0100" }
    ]
}

// AmbientApp/vsomeip.json, IC_app/vsomeip.json
{
    // routing í•„ë“œ ì—†ìŒ â†’ ìë™ìœ¼ë¡œ GearAppì˜ ë¼ìš°íŒ… ë§¤ë‹ˆì € ì‚¬ìš©
    "applications": [...]
}
```

**ë‹¨ì :**
- âš ï¸ GearApp ì¬ì‹œì‘ ì‹œ ëª¨ë“  í†µì‹  ì¤‘ë‹¨
- âš ï¸ GearAppì´ ë‹¤ë¥¸ ì•±ë³´ë‹¤ ë¨¼ì € ì‹¤í–‰ë˜ì–´ì•¼ í•¨

**í˜„ì¬ êµ¬ì¡°: ë°©ë²• 2 ì‚¬ìš© (ì „ìš© ë¼ìš°íŒ… ë§¤ë‹ˆì €)**

---

## í…ŒìŠ¤íŠ¸ 1: VehicleControl â†” AmbientApp

### ëª©í‘œ
VehicleControlECUì˜ `gearChanged` ì´ë²¤íŠ¸ë¥¼ AmbientApp(ECU2)ì´ ìˆ˜ì‹ í•˜ì—¬ ì•°ë¹„ì–¸íŠ¸ ë¼ì´íŠ¸ ìƒ‰ìƒ ë³€ê²½

### í†µì‹  ê²½ë¡œ
```
ECU1 (VehicleControlApp)
    â†“ Event: gearChanged(newGear, oldGear, timestamp)
    â†“ ë„¤íŠ¸ì›Œí¬: 224.244.224.245:30490 (Service Discovery)
    â†“ ë„¤íŠ¸ì›Œí¬: 192.168.1.101:30501 (Event Data)
ECU2 (AmbientApp)
    â†’ ê¸°ì–´ ìƒíƒœì— ë”°ë¼ ì•°ë¹„ì–¸íŠ¸ ìƒ‰ìƒ ë³€ê²½
       P = Blue, R = Orange, N = Yellow, D = Green
```

### 1ë‹¨ê³„: AmbientApp ì„¤ì • ìˆ˜ì •

**íŒŒì¼:** `/home/leo/SEA-ME/DES_Head-Unit/app/AmbientApp/vsomeip.json`

**ìˆ˜ì • ì „:**
```json
{
    "unicast": "127.0.0.1",
    "logging": { ... },
    "applications": [
        {
            "name": "AmbientApp",
            "id": "0x1236"
        }
    ],
    "clients": [
        {
            "service": "0x1235",
            "instance": "0x5679"
        }
    ]
}
```

**ìˆ˜ì • í›„:**
```json
{
    "unicast": "192.168.1.101",  // â† ECU2 IP
    "netmask": "255.255.255.0",
    "logging": {
        "level": "debug",
        "console": "true",
        "file": { "enable": "false" },
        "dlt": "false"
    },
    "applications": [
        {
            "name": "AmbientApp",
            "id": "0x0200"  // â† ID ë³€ê²½ (0x1236 â†’ 0x0200)
        }
    ],
    "service-discovery": {
        "enable": "true",
        "multicast": "224.244.224.245",
        "port": "30490",
        "protocol": "udp",
        "initial_delay_min": "10",
        "initial_delay_max": "100",
        "repetitions_base_delay": "200",
        "repetitions_max": "3",
        "ttl": "3",
        "cyclic_offer_delay": "2000",
        "request_response_delay": "1500"
    },
    "clients": [
        {
            "service": "0x1234",  // â† VehicleControl ì„œë¹„ìŠ¤
            "instance": "0x5678",
            "unreliable": "30501"
        },
        {
            "service": "0x1235",  // â† MediaApp ì„œë¹„ìŠ¤ (ë³¼ë¥¨ ì´ë²¤íŠ¸)
            "instance": "0x5679"
        }
    ]
}
```

**ì£¼ìš” ë³€ê²½ ì‚¬í•­:**
- âœ… `unicast`: 127.0.0.1 â†’ 192.168.1.101
- âœ… `id`: 0x1236 â†’ 0x0200
- âœ… VehicleControl ì„œë¹„ìŠ¤(0x1234:0x5678) Client ì¶”ê°€
- âœ… MediaApp ì„œë¹„ìŠ¤(0x1235:0x5679) ìœ ì§€
- âš ï¸ `routing` í•„ë“œ ì—†ìŒ â†’ GearAppì˜ ë¼ìš°íŒ… ë§¤ë‹ˆì € ìë™ ì‚¬ìš©

### 2ë‹¨ê³„: ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸

```bash
# ============================================
# ECU1 (192.168.1.100) - VehicleControlECU
# ============================================
cd ~/SEA-ME/DES_Head-Unit/app/VehicleControlECU
./run.sh

# ì˜ˆìƒ ë¡œê·¸:
# [info] Routing Manager [VehicleControlECU] running
# [info] OFFER(1234.5678): [192.168.1.100:30501]

# ============================================
# ECU2 (192.168.1.101) - GearApp ë¨¼ì € ì‹¤í–‰ (ë¼ìš°íŒ… ë§¤ë‹ˆì € ì—­í• )
# ============================================
cd ~/SEA-ME/DES_Head-Unit/app/GearApp
./run.sh

# ì˜ˆìƒ ë¡œê·¸:
# [info] Routing Manager [client-sample] running
# [info] Service [1234.5678] is available.

# ============================================
# ECU2 (192.168.1.101) - AmbientApp ì‹¤í–‰ (ë³„ë„ í„°ë¯¸ë„)
# ============================================
cd ~/SEA-ME/DES_Head-Unit/app/AmbientApp
./run.sh

# ì˜ˆìƒ ë¡œê·¸:
# [info] Client [AmbientApp] registered to routing manager [client-sample]
# [info] Service [1234.5678] is available.
# [info] Subscribed to gearChanged event
```

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤:**
```bash
# 1. GearApp GUIì—ì„œ P â†’ D ì„ íƒ

# 2. AmbientApp ë¡œê·¸ í™•ì¸:
# [Event] gearChanged: newGear=D, oldGear=P, timestamp=...
# [Ambient] Changing color from BLUE to GREEN

# 3. AmbientApp GUI í™•ì¸:
# ì•°ë¹„ì–¸íŠ¸ ë¼ì´íŠ¸ê°€ íŒŒë€ìƒ‰ â†’ ë…¹ìƒ‰ìœ¼ë¡œ ë³€ê²½
```

---

## í…ŒìŠ¤íŠ¸ 2: VehicleControl â†” IC_app

### ëª©í‘œ
VehicleControlECUì˜ `vehicleStateChanged` ì´ë²¤íŠ¸ë¥¼ IC_app(ECU2)ì´ ìˆ˜ì‹ í•˜ì—¬ ê³„ê¸°íŒ ì—…ë°ì´íŠ¸

### í†µì‹  ê²½ë¡œ
```
ECU1 (VehicleControlApp)
    â†“ Event: vehicleStateChanged(gear, speed, battery, timestamp)
    â†“ ì£¼ê¸°: 100ms (10Hz)
    â†“ ë„¤íŠ¸ì›Œí¬: 192.168.1.101:30501
ECU2 (IC_app - Instrument Cluster)
    â†’ ê³„ê¸°íŒ í‘œì‹œ ì—…ë°ì´íŠ¸
       - Gear: P/R/N/D
       - Speed: 0~200 km/h
       - Battery: 0~100%
```

### 1ë‹¨ê³„: IC_app ì„¤ì • ìˆ˜ì •

**íŒŒì¼:** `/home/leo/SEA-ME/DES_Head-Unit/app/IC_app/vsomeip_ic.json`

**ìˆ˜ì • ì „:**
```json
{
    "unicast": "192.168.1.101",
    "applications": [
        {
            "name": "IC_app",
            "id": "0x0400"
        }
    ],
    "routing": "vsomeipd",  // â† ë¬¸ì œ!
    "services": [  // â† Clientì¸ë° "services" ì‚¬ìš©
        {
            "service": "0x1234",
            "instance": "0x5678",
            "unreliable": "30508"
        }
    ]
}
```

**ìˆ˜ì • í›„:**
```json
{
    "unicast": "192.168.1.101",
    "netmask": "255.255.255.0",
    "logging": {
        "level": "debug",
        "console": "true",
        "file": { "enable": "false" },
        "dlt": "false"
    },
    "applications": [
        {
            "name": "IC_app",
            "id": "0x0300"  // â† ID ë³€ê²½ (0x0400 â†’ 0x0300)
        }
    ],
    "service-discovery": {
        "enable": "true",
        "multicast": "224.244.224.245",
        "port": "30490",
        "protocol": "udp",
        "initial_delay_min": "10",
        "initial_delay_max": "100",
        "repetitions_base_delay": "200",
        "repetitions_max": "3",
        "ttl": "3",
        "cyclic_offer_delay": "2000",
        "request_response_delay": "1500"
    },
    "clients": [  // â† "services" â†’ "clients" ë³€ê²½
        {
            "service": "0x1234",
            "instance": "0x5678",
            "unreliable": "30501"  // â† ECU1ì˜ í¬íŠ¸
        }
    ]
}
```

**ì£¼ìš” ë³€ê²½ ì‚¬í•­:**
- âŒ `routing` í•„ë“œ ì‚­ì œ â†’ GearAppì˜ ë¼ìš°íŒ… ë§¤ë‹ˆì € ì‚¬ìš©
- âœ… `id`: 0x0400 â†’ 0x0300
- âœ… `services` â†’ `clients` ë³€ê²½
- âœ… í¬íŠ¸: 30508 â†’ 30501 (ECU1 ì„œë¹„ìŠ¤ í¬íŠ¸)

### 2ë‹¨ê³„: ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸

```bash
# ============================================
# ECU1 - VehicleControlECU ì‹¤í–‰ (ì´ë¯¸ ì‹¤í–‰ ì¤‘ì´ë©´ ìƒëµ)
# ============================================
cd ~/SEA-ME/DES_Head-Unit/app/VehicleControlECU
./run.sh

# ============================================
# ECU2 - GearApp ì‹¤í–‰ (ë¼ìš°íŒ… ë§¤ë‹ˆì €)
# ============================================
cd ~/SEA-ME/DES_Head-Unit/app/GearApp
./run.sh

# ============================================
# ECU2 - IC_app ì‹¤í–‰ (ë³„ë„ í„°ë¯¸ë„)
# ============================================
cd ~/SEA-ME/DES_Head-Unit/app/IC_app
./run.sh

# ì˜ˆìƒ ë¡œê·¸ (IC_app):
# [info] Client [IC_app] registered to routing manager [client-sample]
# [info] Service [1234.5678] is available.
# [info] Subscribed to vehicleStateChanged event
# [Event] vehicleStateChanged: gear=P, speed=0, battery=100%, timestamp=...
```

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤:**
```bash
# 1. VehicleControlECUì—ì„œ ì°¨ëŸ‰ ìƒíƒœ ë³€ê²½
#    - ë¦¬ëª¨ì»¨ìœ¼ë¡œ ì†ë„ ì¦ê°€
#    - GearAppì—ì„œ ê¸°ì–´ ë³€ê²½

# 2. IC_app ë¡œê·¸ í™•ì¸:
# [Event] vehicleStateChanged: gear=D, speed=35, battery=87%
# [Event] vehicleStateChanged: gear=D, speed=40, battery=86%

# 3. IC_app GUI í™•ì¸:
#    - ì†ë„ê³„ ë°”ëŠ˜ ì´ë™
#    - ë°°í„°ë¦¬ ê²Œì´ì§€ ì—…ë°ì´íŠ¸
#    - ê¸°ì–´ í‘œì‹œ ë³€ê²½
```

---

## í…ŒìŠ¤íŠ¸ 3: MediaApp â†’ AmbientApp (HU ë‚´ë¶€ í†µì‹ )

### ëª©í‘œ
MediaAppì˜ ë³¼ë¥¨ ë³€ê²½ ì´ë²¤íŠ¸ë¥¼ AmbientAppì´ ìˆ˜ì‹ í•˜ì—¬ ì•°ë¹„ì–¸íŠ¸ ë°ê¸° ì¡°ì ˆ

### í†µì‹  ê²½ë¡œ
```
ECU2 (MediaApp)
    â†“ Event: volumeChanged(volume)
    â†“ ë‚´ë¶€ í†µì‹ : vsomeip local (Unix socket)
    â†“ Service: 0x1235:0x5679
ECU2 (AmbientApp)
    â†’ ë³¼ë¥¨ì— ë”°ë¼ ì•°ë¹„ì–¸íŠ¸ ë°ê¸° ì¡°ì ˆ
       Volume 0-30: ì–´ë‘ì›€
       Volume 30-70: ì¤‘ê°„
       Volume 70-100: ë°ìŒ
```

### 1ë‹¨ê³„: MediaApp í™•ì¸

**íŒŒì¼:** `/home/leo/SEA-ME/DES_Head-Unit/app/MediaApp/vsomeip.json`

**ì˜ˆìƒ ì„¤ì •:**
```json
{
    "unicast": "192.168.1.101",
    "applications": [
        {
            "name": "MediaApp",
            "id": "0x1236"
        }
    ],
    "services": [  // â† MediaAppì€ Service Provider
        {
            "service": "0x1235",
            "instance": "0x5679",
            "unreliable": "30510"  // â† ë¡œì»¬ í¬íŠ¸
        }
    ]
}
```

### 2ë‹¨ê³„: ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸

```bash
# ============================================
# ECU2 - GearApp ì‹¤í–‰ (ë¼ìš°íŒ… ë§¤ë‹ˆì €)
# ============================================
cd ~/SEA-ME/DES_Head-Unit/app/GearApp
./run.sh

# ============================================
# ECU2 - MediaApp ì‹¤í–‰
# ============================================
cd ~/SEA-ME/DES_Head-Unit/app/MediaApp
./run.sh

# ì˜ˆìƒ ë¡œê·¸:
# [info] OFFER(1235.5679): local

# ============================================
# ECU2 - AmbientApp ì‹¤í–‰
# ============================================
cd ~/SEA-ME/DES_Head-Unit/app/AmbientApp
./run.sh

# ì˜ˆìƒ ë¡œê·¸:
# [info] Service [1235.5679] is available.
# [info] Subscribed to volumeChanged event
```

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤:**
```bash
# 1. MediaAppì—ì„œ ë³¼ë¥¨ ë³€ê²½ (0 â†’ 100)

# 2. AmbientApp ë¡œê·¸ í™•ì¸:
# [Event] volumeChanged: volume=50
# [Ambient] Brightness: 50%

# 3. AmbientApp GUI í™•ì¸:
#    - ì•°ë¹„ì–¸íŠ¸ ë¼ì´íŠ¸ ë°ê¸° ë³€í™”
```

---

## í…ŒìŠ¤íŠ¸ 4: GearApp â†’ VehicleControl â†’ All Apps (ì „ì²´ ì´ë²¤íŠ¸ ì „íŒŒ)

### ëª©í‘œ
GearApp ê¸°ì–´ ë³€ê²½ ì‹œ ëª¨ë“  êµ¬ë… ì•±ìœ¼ë¡œ ì´ë²¤íŠ¸ ì „íŒŒ í™•ì¸

### ì „ì²´ í†µì‹  íë¦„
```
ECU2 - GearApp (GUI)
    â†“ ì‚¬ìš©ì ì…ë ¥: P â†’ D
    â†“ RPC: setGearPosition("D") 
    â†“ ë„¤íŠ¸ì›Œí¬: 192.168.1.100:30501
    â†“
ECU1 - VehicleControlApp
    â†“ ê¸°ì–´ ë³€ê²½ ì²˜ë¦¬
    â†“ Broadcast: gearChanged("D", "P", timestamp)
    â†“ Broadcast: vehicleStateChanged(gear="D", speed, battery, timestamp)
    â†“ ë„¤íŠ¸ì›Œí¬: multicast 224.244.224.245:30490
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â†“                              â†“                  â†“
ECU2 - GearApp             ECU2 - AmbientApp    ECU2 - IC_app
GUI ì—…ë°ì´íŠ¸               ì•°ë¹„ì–¸íŠ¸ ìƒ‰ìƒ ë³€ê²½     ê³„ê¸°íŒ ì—…ë°ì´íŠ¸
íŒŒë€ìƒ‰ â†’ ë…¹ìƒ‰ ê°•ì¡°          íŒŒë€ìƒ‰ â†’ ë…¹ìƒ‰        Gear: D í‘œì‹œ
```

### ì‹¤í–‰ ìˆœì„œ

```bash
# ============================================
# ECU1 - VehicleControlECU ì‹¤í–‰
# ============================================
cd ~/SEA-ME/DES_Head-Unit/app/VehicleControlECU
./run.sh

# ì˜ˆìƒ ë¡œê·¸:
# [info] Routing Manager [VehicleControlECU] running
# [info] OFFER(1234.5678): [192.168.1.100:30501]

# ============================================
# ECU2 - Terminal 1: GearApp (ë¼ìš°íŒ… ë§¤ë‹ˆì €)
# ============================================
cd ~/SEA-ME/DES_Head-Unit/app/GearApp
./run.sh

# ì˜ˆìƒ ë¡œê·¸:
# [info] Routing Manager [client-sample] running
# [info] Service [1234.5678] is available.

# ============================================
# ECU2 - Terminal 2: AmbientApp
# ============================================
cd ~/SEA-ME/DES_Head-Unit/app/AmbientApp
./run.sh

# ì˜ˆìƒ ë¡œê·¸:
# [info] Client [AmbientApp] registered
# [info] Service [1234.5678] is available.
# [info] Subscribed to gearChanged event

# ============================================
# ECU2 - Terminal 3: IC_app
# ============================================
cd ~/SEA-ME/DES_Head-Unit/app/IC_app
./run.sh

# ì˜ˆìƒ ë¡œê·¸:
# [info] Client [IC_app] registered
# [info] Service [1234.5678] is available.
# [info] Subscribed to vehicleStateChanged event
```

### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

**ì‹œë‚˜ë¦¬ì˜¤ 1: P â†’ D ê¸°ì–´ ë³€ê²½**
```
1. GearApp GUIì—ì„œ P ë²„íŠ¼ í´ë¦­ (í˜„ì¬ P ìƒíƒœ)
   â†’ VehicleControlECU: [RPC] setGearPosition(P)
   â†’ VehicleControlECU: Gear already P, but still processing
   
2. GearApp GUIì—ì„œ D ë²„íŠ¼ í´ë¦­
   â†’ VehicleControlECU: [RPC] setGearPosition(D)
   â†’ VehicleControlECU: Gear changed: P â†’ D
   â†’ VehicleControlECU: [Event] gearChanged(D, P, timestamp)
   â†’ VehicleControlECU: [Event] vehicleStateChanged(D, 0, 100%, timestamp)

3. âœ… GearApp í™•ì¸:
   - [Event] Received gearChanged: D
   - GUI: D ë²„íŠ¼ ë…¹ìƒ‰ ê°•ì¡°, P ë²„íŠ¼ íšŒìƒ‰

4. âœ… AmbientApp í™•ì¸:
   - [Event] Received gearChanged: newGear=D, oldGear=P
   - Ambient: íŒŒë€ìƒ‰ â†’ ë…¹ìƒ‰ ë³€ê²½

5. âœ… IC_app í™•ì¸:
   - [Event] Received vehicleStateChanged: gear=D
   - Dashboard: "D" í‘œì‹œ
```

**ì‹œë‚˜ë¦¬ì˜¤ 2: ì†ë„ ë³€í™” (ë¦¬ëª¨ì»¨ ì¡°ì‘)**
```
1. VehicleControlECU: ë¦¬ëª¨ì»¨ ê°€ì† ì…ë ¥
   â†’ Speed: 0 â†’ 30 km/h
   â†’ [Event] vehicleStateChanged(D, 30, 95%, timestamp)

2. âœ… IC_app í™•ì¸:
   - [Event] Received vehicleStateChanged: speed=30
   - Dashboard: ì†ë„ê³„ ë°”ëŠ˜ 30ìœ¼ë¡œ ì´ë™
```

---

## í†µí•© í…ŒìŠ¤íŠ¸: ì „ì²´ ì‹œìŠ¤í…œ

### ğŸ¯ ëª©í‘œ
ECU1(VehicleControl) + ECU2(GearApp, AmbientApp, IC_app, MediaApp) ì „ì²´ ë™ì‹œ ì‹¤í–‰ ë° í†µì‹  ê²€ì¦

### ì‹¤í–‰ ì „ ì¤€ë¹„

#### ECU1 ì¤€ë¹„ ì‚¬í•­
```bash
# 1. ë„¤íŠ¸ì›Œí¬ ì„¤ì •
sudo nmcli device set eth0 managed no
sudo ip link set eth0 up
sudo ip addr add 192.168.1.100/24 dev eth0
sudo ip route add 224.0.0.0/4 dev eth0

# 2. ì™„ì „ í´ë¦°ì—…
killall -9 VehicleControlECU 2>/dev/null
pkill -9 -f vsomeip 2>/dev/null
sudo rm -rf /tmp/vsomeip-*

# 3. ë„¤íŠ¸ì›Œí¬ ê²€ì¦
ping -c 3 192.168.1.101
ip route | grep 224.0.0.0
```

#### ECU2 ì¤€ë¹„ ì‚¬í•­
```bash
# 1. ë„¤íŠ¸ì›Œí¬ ì„¤ì •
sudo nmcli device set eth0 managed no
sudo ip link set eth0 up
sudo ip addr add 192.168.1.101/24 dev eth0
sudo ip route add 224.0.0.0/4 dev eth0

# 2. ì™„ì „ í´ë¦°ì—…
killall -9 GearApp AmbientApp IC_app MediaApp 2>/dev/null
pkill -9 -f vsomeip 2>/dev/null
sudo rm -rf /tmp/vsomeip-*

# 3. ë„¤íŠ¸ì›Œí¬ ê²€ì¦
ping -c 3 192.168.1.100
ip route | grep 224.0.0.0
```

---

### ğŸš€ ì‹¤í–‰ ìˆœì„œ

#### Step 1: ECU1 - VehicleControlECU ì‹¤í–‰

```bash
# ECU1
cd ~/DES_Head-Unit/app/config
./start_ecu1.sh

# ë˜ëŠ” ì§ì ‘:
cd ~/DES_Head-Unit/app/VehicleControlECU
./run.sh

# âœ… í™•ì¸í•  ë¡œê·¸:
# [info] Routing Manager [VehicleControlECU] running as [Host]
# [info] OFFER(1234.5678): [192.168.1.100:30501] (reliable port: 30502)
# [info] vsomeip | Service Discovery started
```

#### Step 2: ECU2 - ì „ì²´ ì‹œìŠ¤í…œ ìë™ ì‹¤í–‰ (ê¶Œì¥)

```bash
# ECU2 - ë¼ìš°íŒ… ë§¤ë‹ˆì € + ëª¨ë“  ì•± ìë™ ì‹¤í–‰
cd ~/DES_Head-Unit/app/config
./start_all_ecu2.sh

# âœ… í™•ì¸í•  ì¶œë ¥:
# [3/6] Starting Routing Manager...
# âœ“ Routing Manager started (PID: 1234)
# âœ“ Routing Manager ready (/tmp/vsomeip-0)
#
# [4/6] Starting GearApp...
# âœ“ GearApp started (PID: 1235)
#
# [5/6] Starting AmbientApp...
# âœ“ AmbientApp started (PID: 1236)
#
# [6/6] Starting IC_app...
# âœ“ IC_app started (PID: 1237)
```

#### Step 2 (ëŒ€ì•ˆ): ECU2 - ìˆ˜ë™ ë‹¨ê³„ë³„ ì‹¤í–‰

ìˆ˜ë™ìœ¼ë¡œ í•˜ë‚˜ì”© ì‹¤í–‰í•˜ê³  ì‹¶ë‹¤ë©´:

**2-1. ECU2 - ë¼ìš°íŒ… ë§¤ë‹ˆì € ë¨¼ì € ì‹¤í–‰**

```bash
# ECU2 - Terminal 1
cd ~/DES_Head-Unit/app/config
./start_routing_manager_ecu2.sh

# âœ… í™•ì¸í•  ë¡œê·¸:
# [info] Routing Manager [routingmanagerd] running as [Host]
# [info] create_routing_root: /tmp/vsomeip-0
# âœ… ECU2 Routing Manager is RUNNING
```

**âš ï¸ ì¤‘ìš”:** ë¼ìš°íŒ… ë§¤ë‹ˆì €ê°€ ë¨¼ì € ì‹¤í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤!

**2-2. ECU2 - GearApp ì‹¤í–‰**

```bash
# ECU2 - Terminal 2
cd ~/DES_Head-Unit/app/GearApp
./run.sh

# âœ… í™•ì¸í•  ë¡œê·¸:
# [info] Client [GearApp] registered to routing manager [routingmanagerd]
# [info] Service [1234.5678] is available (VehicleControl)
# [info] Subscribed to gearChanged event
```

**2-3. ECU2 - AmbientApp ì‹¤í–‰**

```bash
# ECU2 - Terminal 3
cd ~/DES_Head-Unit/app/AmbientApp
./run.sh

# âœ… í™•ì¸í•  ë¡œê·¸:
# [info] Client [AmbientApp] registered to routing manager [routingmanagerd]
# [info] Service [1234.5678] is available (VehicleControl)
# [info] Service [1235.5679] is NOT available (MediaApp - ì•„ì§ ì‹¤í–‰ ì•ˆí•¨)
# [info] Subscribed to gearChanged event
```

**2-4. ECU2 - IC_app ì‹¤í–‰**

```bash
# ECU2 - Terminal 4
cd ~/DES_Head-Unit/app/IC_app
./run.sh

# âœ… í™•ì¸í•  ë¡œê·¸:
# [info] Client [IC_app] registered to routing manager [routingmanagerd]
# [info] Service [1234.5678] is available (VehicleControl)
# [info] Subscribed to vehicleStateChanged event
# [Event] vehicleStateChanged: gear=P, speed=0, battery=100%
```

**2-5. ECU2 - MediaApp ì‹¤í–‰ (ì„ íƒ)**

```bash
# ECU2 - Terminal 5
cd ~/DES_Head-Unit/app/MediaApp
./run.sh

# âœ… í™•ì¸í•  ë¡œê·¸:
# [info] Client [MediaApp] registered to routing manager [routingmanagerd]
# [info] OFFER(1235.5679): local (HU ë‚´ë¶€ í†µì‹ )

# AmbientApp ë¡œê·¸ í™•ì¸:
# [info] Service [1235.5679] is available (MediaApp)
# [info] Subscribed to volumeChanged event
```

### ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SOME/IP Service Discovery Network                     â”‚
â”‚                  Multicast: 224.244.224.245:30490                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ â†‘ Service Discovery                     â†“ â†‘
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ECU1: Vehicle Control    â”‚           â”‚  ECU2: Infotainment     â”‚
        â”‚  192.168.1.100            â”‚           â”‚  192.168.1.101          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                      â”‚                â”‚                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚ VehicleControl  â”‚            â”‚    â”‚  Routing Manager     â”‚             â”‚
â”‚ App             â”‚            â”‚    â”‚  [client-sample]     â”‚             â”‚
â”‚                 â”‚            â”‚    â”‚  [Host]              â”‚             â”‚
â”‚ [Service]       â”‚            â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚ 0x1234:0x5678   â”‚            â”‚               â”‚                         â”‚
â”‚                 â”‚            â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚ Port: 30501 UDP â”‚â—„â”€â”€â”€RPCâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤ GearApp             â”‚              â”‚
â”‚ Port: 30502 TCP â”‚            â”‚    â”‚ [Client] 0x0100     â”‚              â”‚
â”‚                 â”‚            â”‚    â”‚ GUI: Gear Selection â”‚              â”‚
â”‚ [Host]          â”‚            â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚ Routing Mgr:    â”‚            â”‚               â”‚                         â”‚
â”‚ VehicleControl  â”‚            â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚    â”‚ AmbientApp          â”‚              â”‚
         â”‚                     â”‚    â”‚ [Client] 0x0200     â”‚              â”‚
         â”‚ Events:             â”‚    â”‚ Ambient Light       â”‚              â”‚
         â”‚ - gearChanged       â”‚â—„â”€â”€â”€â”¤ Subscribe:          â”‚              â”‚
         â”‚ - vehicleState      â”‚    â”‚  â€¢ gearChanged      â”‚              â”‚
         â”‚   Changed           â”‚    â”‚  â€¢ volumeChanged    â”‚              â”‚
         â”‚                     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
         â”‚                     â”‚               â”‚                         â”‚
         â”‚                     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€Eventâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â–ºâ”‚ IC_app              â”‚              â”‚
                               â”‚    â”‚ [Client] 0x0300     â”‚              â”‚
                               â”‚    â”‚ Dashboard Display   â”‚              â”‚
                               â”‚    â”‚ Subscribe:          â”‚              â”‚
                               â”‚    â”‚  â€¢ vehicleState     â”‚              â”‚
                               â”‚    â”‚    Changed          â”‚              â”‚
                               â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                               â”‚               â–²                         â”‚
                               â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
                               â”‚    â”‚ MediaApp            â”‚              â”‚
                               â”‚    â”‚ [Service] 0x1236    â”‚              â”‚
                               â”‚    â”‚ Service: 0x1235     â”‚              â”‚
                               â”‚    â”‚ Event: volumeChangedâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   (HU ë‚´ë¶€)
                               â”‚
                               â””â”€ ëª¨ë“  HU/IC ì•±ì€ í•˜ë‚˜ì˜ ë¼ìš°íŒ… ë§¤ë‹ˆì € ê³µìœ 
```

**í†µì‹  ìœ í˜•:**
- **ECU ê°„ í†µì‹  (Network)**: ECU1 â†” ECU2 (Ethernet, vsomeip over UDP/TCP)
- **HU ë‚´ë¶€ í†µì‹  (Local)**: MediaApp â†” AmbientApp (Unix socket)

### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ê¸°ì–´ ë³€ê²½
```
1. GearApp GUIì—ì„œ P â†’ D ì„ íƒ
2. âœ… GearApp: RPC ì „ì†¡ â†’ VehicleControlECU
3. âœ… VehicleControlECU: ê¸°ì–´ ë³€ê²½ ì²˜ë¦¬
4. âœ… VehicleControlECU: gearChanged ì´ë²¤íŠ¸ ë¸Œë¡œë“œìºìŠ¤íŠ¸
5. âœ… GearApp: ì´ë²¤íŠ¸ ìˆ˜ì‹  â†’ GUI ë…¹ìƒ‰ ë²„íŠ¼ í™œì„±í™”
6. âœ… AmbientApp: ì´ë²¤íŠ¸ ìˆ˜ì‹  â†’ ì•°ë¹„ì–¸íŠ¸ ë¼ì´íŠ¸ ë…¹ìƒ‰
7. âœ… IC_app: vehicleStateChanged ìˆ˜ì‹  â†’ ê¸°ì–´ í‘œì‹œ "D"
```

#### ì‹œë‚˜ë¦¬ì˜¤ 2: ì°¨ëŸ‰ ìƒíƒœ ì—…ë°ì´íŠ¸ (10Hz)
```
1. VehicleControlECU: 100msë§ˆë‹¤ vehicleStateChanged ë¸Œë¡œë“œìºìŠ¤íŠ¸
2. âœ… IC_app: ì†ë„, ë°°í„°ë¦¬ ë ˆë²¨ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
3. âœ… GearApp: í˜„ì¬ ê¸°ì–´ ë™ê¸°í™”
```

---

## ë¬¸ì œ í•´ê²°

### ë¬¸ì œ 1: AmbientAppì´ Service Discovery ì‹¤íŒ¨

**ì¦ìƒ:**
```
[warning] Service [1234.5678] is not available
```

**ì›ì¸:**
- ë©€í‹°ìºìŠ¤íŠ¸ ë¼ìš°íŒ… ëˆ„ë½
- IP ì£¼ì†Œ ì„¤ì • ì˜¤ë¥˜ (127.0.0.1)

**í•´ê²°:**
```bash
# vsomeip.json í™•ì¸
cat ~/AmbientApp/vsomeip.json
# unicastê°€ 127.0.0.1ì´ë©´ 192.168.1.101 ë˜ëŠ” 192.168.1.102ë¡œ ë³€ê²½

# ë©€í‹°ìºìŠ¤íŠ¸ ë¼ìš°íŒ… ì¶”ê°€
sudo ip route add 224.0.0.0/4 dev eth0

# ì¬ì‹œì‘
killall -9 AmbientApp
sudo rm -rf /tmp/vsomeip-*
./run.sh
```

### ë¬¸ì œ 2: ECU2ì—ì„œ "other routing manager present" ì—ëŸ¬

**ì¦ìƒ:**
```
[error] IC_app: Application is configured to be routing manager, 
        but other routing manager found
```

**ì›ì¸:**
- GearAppì´ ì´ë¯¸ [Host] ë¼ìš°íŒ… ë§¤ë‹ˆì €ë¡œ ì‹¤í–‰ ì¤‘
- IC_appë„ ë…ë¦½ ë¼ìš°íŒ… ë§¤ë‹ˆì €ë¡œ ì„¤ì •ë¨ (`routing` í•„ë“œ ì¡´ì¬)

**í•´ê²°:**
```bash
# ë°©ë²• 1: vsomeip.jsonì—ì„œ routing í•„ë“œ ì œê±° (ê¶Œì¥)
# IC_app/vsomeip_ic.json, AmbientApp/vsomeip.jsonì—ì„œ
# "routing": "..." ì¤„ ì‚­ì œ

# ë°©ë²• 2: ì™„ì „ í´ë¦°ì—… í›„ ìˆœì°¨ ì‹¤í–‰
killall -9 GearApp IC_app AmbientApp 2>/dev/null
pkill -9 -f vsomeip 2>/dev/null
sudo rm -rf /tmp/vsomeip-*

# ì‹¤í–‰ ìˆœì„œ (ë°˜ë“œì‹œ ì§€í‚¬ ê²ƒ):
# 1. GearApp (ë¼ìš°íŒ… ë§¤ë‹ˆì €)
cd ~/SEA-ME/DES_Head-Unit/app/GearApp
./run.sh

# 2. 3ì´ˆ ëŒ€ê¸°
sleep 3

# 3. AmbientApp
cd ~/SEA-ME/DES_Head-Unit/app/AmbientApp
./run.sh

# 4. IC_app
cd ~/SEA-ME/DES_Head-Unit/app/IC_app
./run.sh
```

---

### ë¬¸ì œ 3: AmbientAppì´ VehicleControl ì„œë¹„ìŠ¤ ë°œê²¬ ëª»í•¨

**ì¦ìƒ:**
```
[warning] Service [1234.5678] is not available
```

**ì›ì¸ 1:** `unicast` ì£¼ì†Œê°€ 127.0.0.1
```bash
# vsomeip.json í™•ì¸
cat ~/SEA-ME/DES_Head-Unit/app/AmbientApp/vsomeip.json | grep unicast

# "unicast": "127.0.0.1" ì´ë©´ ìˆ˜ì •
# â†’ "unicast": "192.168.1.101"
```

**ì›ì¸ 2:** VehicleControl ì„œë¹„ìŠ¤(0x1234) Client ì„¤ì • ëˆ„ë½
```json
// AmbientApp/vsomeip.json
{
    "clients": [
        // ì´ê²ƒë§Œ ìˆìœ¼ë©´ VehicleControl ì„œë¹„ìŠ¤ ëª» ì°¾ìŒ
        {
            "service": "0x1235",  // â† MediaApp ì„œë¹„ìŠ¤ë§Œ
            "instance": "0x5679"
        }
    ]
}

// ì¶”ê°€ í•„ìš”:
{
    "clients": [
        {
            "service": "0x1234",  // â† VehicleControl ì„œë¹„ìŠ¤
            "instance": "0x5678",
            "unreliable": "30501"
        },
        {
            "service": "0x1235",  // â† MediaApp ì„œë¹„ìŠ¤
            "instance": "0x5679"
        }
    ]
}
```

**ì›ì¸ 3:** ë©€í‹°ìºìŠ¤íŠ¸ ë¼ìš°íŒ… ëˆ„ë½
```bash
# ECU2ì—ì„œ í™•ì¸
ip route | grep 224.0.0.0

# ì—†ìœ¼ë©´ ì¶”ê°€
sudo ip route add 224.0.0.0/4 dev eth0

# AmbientApp ì¬ì‹œì‘
killall -9 AmbientApp
sudo rm -rf /tmp/vsomeip-*
cd ~/SEA-ME/DES_Head-Unit/app/AmbientApp
./run.sh
```

### ë¬¸ì œ 3: ì—¬ëŸ¬ ì•±ì´ ê°™ì€ Application ID ì‚¬ìš©

**ì¦ìƒ:**
```
[error] Application ID 0x0100 already in use
```

**í•´ê²°:**
ê° ì•±ë§ˆë‹¤ ê³ ìœ  ID í• ë‹¹:
- VehicleControlECU: `0x1001`
- GearApp: `0x0100`
- IC_app: `0x0300`
- AmbientApp: `0x0200`
- MediaApp: `0x0400`

---

## ë‹¤ìŒ ë‹¨ê³„: ì„¤ì • íŒŒì¼ ìë™ ìˆ˜ì •

### ìˆ˜ì • í•„ìš”í•œ íŒŒì¼

#### 1. AmbientApp/vsomeip.json
**ìœ„ì¹˜:** `/home/leo/SEA-ME/DES_Head-Unit/app/AmbientApp/vsomeip.json`

**ë³€ê²½ ì‚¬í•­:**
- âœï¸ `unicast`: 127.0.0.1 â†’ 192.168.1.101
- âœï¸ `id`: 0x1236 â†’ 0x0200
- âœï¸ `clients`ì— VehicleControl ì„œë¹„ìŠ¤(0x1234:0x5678) ì¶”ê°€
- âœï¸ MediaApp ì„œë¹„ìŠ¤(0x1235:0x5679) ìœ ì§€
- âš ï¸ `routing` í•„ë“œ ìˆìœ¼ë©´ ì œê±°

---

#### 2. IC_app/vsomeip_ic.json
**ìœ„ì¹˜:** `/home/leo/SEA-ME/DES_Head-Unit/app/IC_app/vsomeip_ic.json`

**ë³€ê²½ ì‚¬í•­:**
- âœï¸ `id`: 0x0400 â†’ 0x0300
- âš ï¸ `routing` í•„ë“œ ì œê±°
- âœï¸ `services` â†’ `clients` ë³€ê²½
- âœï¸ í¬íŠ¸: 30508 â†’ 30501

---

### ìë™ ìˆ˜ì • ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

```bash
# ë°±ì—… ìƒì„±
cp ~/SEA-ME/DES_Head-Unit/app/AmbientApp/vsomeip.json \
   ~/SEA-ME/DES_Head-Unit/app/AmbientApp/vsomeip.json.backup

cp ~/SEA-ME/DES_Head-Unit/app/IC_app/vsomeip_ic.json \
   ~/SEA-ME/DES_Head-Unit/app/IC_app/vsomeip_ic.json.backup

# ì„¤ì • íŒŒì¼ ìˆ˜ì • (ì œê°€ ë„ì™€ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤)
# ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (yes/no)
```

---

### ìˆ˜ì • í›„ í…ŒìŠ¤íŠ¸ ìˆœì„œ

1. âœ… **AmbientApp/vsomeip.json ìˆ˜ì •**
2. âœ… **IC_app/vsomeip_ic.json ìˆ˜ì •**
3. ğŸ”„ **ì „ì²´ ì‹œìŠ¤í…œ ì¬ì‹œì‘**
   - ECU1: VehicleControlECU
   - ECU2: GearApp â†’ AmbientApp â†’ IC_app
4. âœ… **í…ŒìŠ¤íŠ¸ 1**: VehicleControl â†” AmbientApp
5. âœ… **í…ŒìŠ¤íŠ¸ 2**: VehicleControl â†” IC_app
6. âœ… **í…ŒìŠ¤íŠ¸ 3**: MediaApp â†” AmbientApp (HU ë‚´ë¶€)
7. âœ… **í†µí•© í…ŒìŠ¤íŠ¸**: ì „ì²´ ì´ë²¤íŠ¸ ì „íŒŒ í™•ì¸

---

## ğŸ“š ì°¸ê³ : ECU2 í†µì‹  ê³„ì¸µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ECU2 Applications                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ GearApp  â”‚  â”‚ AmbientAppâ”‚  â”‚ IC_app â”‚  â”‚MediaApp â”‚ â”‚
â”‚  â”‚ 0x0100   â”‚  â”‚  0x0200   â”‚  â”‚ 0x0300 â”‚  â”‚ 0x1236  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚              â”‚              â”‚           â”‚      â”‚
â”‚       â”‚              â”‚              â”‚           â”‚      â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”‚
â”‚  â”‚        Routing Manager [client-sample]           â”‚ â”‚
â”‚  â”‚                    [Host]                         â”‚ â”‚
â”‚  â”‚  - Unix Socket: /tmp/vsomeip-*                   â”‚ â”‚
â”‚  â”‚  - ëª¨ë“  ë¡œì»¬ ì•± ê´€ë¦¬                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ vsomeip Network (UDP/TCP)
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ECU1 - VehicleControlApp                    â”‚
â”‚         Routing Manager [VehicleControlECU]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•µì‹¬ í¬ì¸íŠ¸:**
- ECU2ì˜ ëª¨ë“  ì•±(GearApp, AmbientApp, IC_app, MediaApp)ì€ **í•˜ë‚˜ì˜ ë¼ìš°íŒ… ë§¤ë‹ˆì € ê³µìœ **
- GearAppì´ ë¼ìš°íŒ… ë§¤ë‹ˆì € ì—­í•  (`"routing": "client-sample"`)
- ë‹¤ë¥¸ ì•±ë“¤ì€ `routing` í•„ë“œ ì—†ì´ GearAppì˜ ë¼ìš°íŒ… ë§¤ë‹ˆì € ì‚¬ìš©
- **HU ë‚´ë¶€ í†µì‹ **(MediaApp â†” AmbientApp)ì€ Unix socket
- **ECU ê°„ í†µì‹ **(ECU1 â†” ECU2)ì€ Ethernet (UDP/TCP)

ìˆ˜ì • ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
